# FEM4C 要件定義書

## 1. プロジェクト概要

### 1.1 目的
既存のFortran製高性能FEMソルバー（highperformanceFEM）をC言語に変換し、機能別にリファクタリングした構造化されたソルバーを作成する。

### 1.2 背景
- 原著者：山田貴博氏著「高性能有限要素法」ベースのソルバー
- 現在：83個のFortranファイルで構成
- 課題：保守性とモジュール化の改善が必要

## 2. 機能要件

### 2.1 解析機能
- **解析タイプ**：線形静解析のみ
- **次元**：2次元平面応力・平面ひずみ、3次元固体
- **要素タイプ**：全要素タイプに対応（段階的実装）
  - 優先実装：T6要素（2次元6節点三角形要素）
  - 後続実装：Q4, Q9, H8, T4, T10等

### 2.2 入出力機能
- **入力形式**：Nastranバルクファイル（.bdf, .nas）
- **要素自動判別**：入力ファイルから要素タイプを自動判別
- **出力形式**：変位、応力結果ファイル

### 2.3 性能要件
- **並列化**：OpenMP対応（MPIは不要）
- **メモリ管理**：固定サイズ配列使用
- **処理性能**：既存Fortranソルバー同等以上

## 3. 非機能要件

### 3.1 開発環境
- **言語**：C言語（C99標準）
- **コンパイラ**：GCC, Clang対応
- **並列化**：OpenMP 3.0以上
- **プラットフォーム**：Linux, Windows, macOS

### 3.2 品質要件
- **保守性**：機能別モジュール分割
- **可読性**：構造化プログラミング
- **信頼性**：戻り値によるエラーハンドリング
- **性能**：配列中心設計による高速化

### 3.3 制約事項
- 元ソース（highperformanceFEM/）は参照のみ、編集禁止
- 開発はFEM4C/ディレクトリ内のみ
- 固定サイズ配列（MAX_NODES=100000, MAX_ELEMENTS=50000）

## 4. システム構成

### 4.1 データ構造設計
```c
// 固定サイズ配列ベース
#define MAX_NODES    100000
#define MAX_ELEMENTS 50000

double node_coords[MAX_NODES][3];           // 節点座標
double node_displ[MAX_NODES][3];            // 節点変位
int element_nodes[MAX_ELEMENTS][MAX_NODES_PER_ELEM]; // 要素接続
```

### 4.2 エラーハンドリング
- 戻り値方式採用
- 0: 成功、非0: エラーコード
- エラーメッセージ出力機能

## 5. 開発方針

### 5.1 段階的開発
1. **Phase 1**：T6要素による基本フレームワーク構築
2. **Phase 2**：他2D要素への拡張
3. **Phase 3**：3D要素対応
4. **Phase 4**：Nastranファイル対応

### 5.2 品質保証
- 既存Fortranソルバーとの結果比較検証
- 各要素タイプでの回帰テスト実施
- OpenMP並列化性能テスト

## 6. 成果物

### 6.1 ソースコード
- C言語ソースファイル群
- Makefile/CMakeLists.txt
- ヘッダーファイル

### 6.2 ドキュメント
- 設計書
- ユーザーマニュアル
- テスト仕様書

## 7. スケジュール（概算）

| Phase | 内容 | 期間 |
|-------|------|------|
| Phase 1 | T6要素フレームワーク | 2週間 |
| Phase 2 | 2D要素拡張 | 3週間 |
| Phase 3 | 3D要素対応 | 3週間 |
| Phase 4 | Nastran対応 | 2週間 |

**総開発期間**：約10週間

---
**作成日**: 2025-09-24  
**バージョン**: 1.0  
**ステータス**: 承認待ち