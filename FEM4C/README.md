# FEM4C - 高性能有限要素法（C言語版）

## 概要
FEM4Cは、山田貴博氏著「高性能有限要素法」に基づく有限要素解析ソルバーをFortranからC言語に変換したものです。構造解析における線形静的問題の高速求解を目的としています。

## 特徴
- **線形静解析**: 2次元・3次元構造の静的解析に対応
- **要素タイプ**: T6（6節点三角形要素）を中心とした実装、将来的にQ4、H8、T4、T10等に対応予定
- **OpenMP対応**: 並列処理による高速化（準備完了）
- **スカイライン行列格納**: 全体剛性をバンド構造で保持しメモリ使用量を削減
- **包括的エラー処理**: 戻り値方式による確実なエラーハンドリング

## 現在の実装状況: Phase 1 完了 ✅

### 実装済み機能
- ✅ ディレクトリ構造とビルドシステム
- ✅ 共通モジュール（定数、型定義、グローバル変数）
- ✅ エラーハンドリングシステム
- ✅ 入出力モジュール（ネイティブ形式対応）
- ✅ T6要素完全実装
- ✅ 剛性行列組み立て
- ✅ 共役勾配法ソルバー
- ✅ 境界条件処理
- ✅ 統合解析ドライバー

### 次期実装予定
- 🔄 Nastranファイル形式対応
- 🔄 2D要素拡張（Q4、T3、Q9等）
- 🔄 3D要素対応（H8、T4、T10等）
- 🔄 OpenMP並列化

## ビルド方法

### 必要環境
- GCC コンパイラ（C99対応）
- Make ユーティリティ
- OpenMPライブラリ（オプション）

### クイックビルド
```bash
make                # 標準ビルド
make release        # OpenMP対応最適化ビルド
make debug          # デバッグビルド
```

### その他のビルドオプション
```bash
make openmp         # OpenMP対応ビルド
make clean          # ビルドファイル削除
make test           # テスト実行（利用可能時）
make help           # 全ビルドターゲット表示
```

## 使用方法
```bash
./bin/fem4c [入力ファイル] [出力ファイル]
```

### 実行例
```bash
# テストケース実行
./bin/fem4c test/data/t6_simple.dat results.dat

# ファイル指定なしの場合
./bin/fem4c  # input.dat → output.dat
```

## プロジェクト構成
```
FEM4C/
├── src/                # ソースコード
│   ├── common/         # 共通モジュール
│   ├── elements/       # 要素実装
│   │   └── t6/         # T6要素
│   ├── solver/         # 線形ソルバー
│   ├── io/             # 入出力処理
│   ├── analysis/       # 解析ドライバー
│   └── fem4c.c         # メインプログラム
├── test/               # テストケース
│   ├── data/           # テストデータ
│   └── unit/           # 単体テスト
├── docs/               # ドキュメント
├── examples/           # 使用例
└── README.md           # このファイル
```

## 入力ファイル形式

### ネイティブ形式
```
# コメント行
タイトル

節点数 要素数
節点番号 X座標 Y座標
...
要素番号 節点1 節点2 節点3 節点4 節点5 節点6
...
ヤング率 ポアソン比
節点番号 X拘束 Y拘束 Z拘束 X変位 Y変位 Z変位
...
point loads
節点番号 X荷重 Y荷重 Z荷重
...
body
Fx Fy Fz

press
圧力値
節点1 節点2 節点3
...

tract
境界数
節点1 節点2 節点3 Tx Ty Tz
...
end
```

`press` セクションでは圧力値の後に外向き法線を得る順序で 3 節点（端点 2 節点と中点 1 節点）を列挙します。

## メモリ制限
- 最大節点数: 10,000
- 最大要素数: 5,000  
- 最大材料数: 100

これらの制限は `src/common/constants.h` で変更可能です。

## 実行例とテスト

### 基本テスト
```bash
# T6要素単体テスト
make && ./bin/fem4c test/data/t6_simple.dat output.dat

# 結果確認
cat output.dat
```

### 単体テストの実行
```bash
# T6要素単体テスト（利用可能時）
cd test/unit
gcc -I../../src test_t6_element.c ../../bin/fem4c -o test_t6
./test_t6
```

## 性能特性
- **固定配列**: 高速メモリアクセス
- **共役勾配法**: 大規模問題対応
- **OpenMP準備**: 並列処理対応（Phase 2で実装予定）
- **モジュール設計**: 保守性と拡張性

## 開発状況

### Phase 1 (完了): T6要素基本フレームワーク
- **期間**: 完了
- **成果**: 基本解析システム構築完了

### Phase 2 (予定): 2D要素拡張
- **期間**: 3週間予定
- **内容**: Q4、T3、Q9要素実装

### Phase 3 (予定): 3D要素対応
- **期間**: 3週間予定
- **内容**: H8、T4、T10要素実装

### Phase 4 (予定): Nastran対応・最終化
- **期間**: 2週間予定
- **内容**: Nastranファイル対応、OpenMP並列化

## トラブルシューティング

### コンパイルエラー
```bash
# 大規模配列でのリンクエラーの場合
make clean
# constants.hでMAX_NODESを削減するか
# -mcmodel=largeオプションを使用（Makefile設定済み）
```

### 実行時エラー
```bash
# ファイルが見つからない場合
ls test/data/  # テストデータの確認
```

## ライセンス
本ソフトウェアは山田貴博氏の原著作をベースとしています。各ソースファイル内の著作権表示をご確認ください。

## 開発・貢献
本プロジェクトはPhase 1の基本実装が完了しており、Phase 2以降の拡張開発に向けた基盤が整っています。

## 連絡先
質問や貢献については、`docs/` ディレクトリ内のプロジェクトドキュメントをご参照ください。

---
**最終更新**: 2025-09-24  
**バージョン**: 1.0 (Phase 1 完了)  
**実装状況**: T6要素対応完全実装済み
